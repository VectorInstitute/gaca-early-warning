{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\ud83d\udea8 GACA Early Warning System","text":""},{"location":"#noaa-urma-graph-neural-network-gcn-gru-temperature-forecasting","title":"NOAA URMA \u2192 Graph Neural Network (GCN-GRU) Temperature Forecasting","text":"<p>This repository contains the modular inference pipeline for the GACA Early Warning System, a high-resolution Graph Neural Network framework that generates localized temperature forecasts from NOAA URMA meteorological data.</p> <p>The pipeline takes the most recent URMA hourly fields, preprocesses them into graph-structured tensors, and produces multi-horizon (1\u201348h) temperature predictions across thousands of spatial nodes in Southwestern Ontario.</p>"},{"location":"#repository-structure","title":"Repository Structure","text":"<ul> <li><code>model/</code> \u2192 trained GNN model (.pth) + feature/target scalers</li> <li><code>data/</code> \u2192 inference graph (edge_index, edge_weight, node lat/lon)</li> <li><code>util/</code> \u2192 preprocessing, plotting, config loader, extraction utilities</li> <li><code>main.py</code> \u2192 end-to-end inference runner (fetch \u2192 preprocess \u2192 predict \u2192 save)</li> <li><code>gen_maps_from_preds.ipynb</code> \u2192 notebook for testing + visualizing predictions</li> <li><code>config.yaml</code> \u2192 main configuration for paths + model settings</li> </ul> <p>\u26a0\ufe0f Important: Update the paths inside <code>config.yaml</code> before running <code>main.py</code>, otherwise results will be saved inside the repo.</p>"},{"location":"#author","title":"Author","text":"<p>Joud El-Shawa - Vector Institute for AI &amp; Western University</p> <p>This repository is intended for early deployment testing of the GACA forecasting pipeline.</p>"},{"location":"dev_guide/","title":"GACA Early Warning System - Developer Guide","text":""},{"location":"dev_guide/#overview","title":"Overview","text":"<p>The GACA EWS is a professional Python package with three interfaces: 1. Modern CLI - Built with Typer and Rich for beautiful terminal output 2. FastAPI Backend - REST API for programmatic access 3. Next.js Dashboard - (In progress) Web UI for visualization</p> <p>All interfaces share the same core inference engine, ensuring code reuse and consistency.</p>"},{"location":"dev_guide/#architecture-code-reuse-modularity","title":"Architecture: Code Reuse &amp; Modularity","text":"<p>The system follows DRY (Don't Repeat Yourself) principles with a single source of truth for inference logic:</p> <pre><code>src/gaca_ews/\n\u251c\u2500\u2500 core/\n\u2502   \u251c\u2500\u2500 inference.py       \u2190 InferenceEngine: Single source of truth\n\u2502   \u251c\u2500\u2500 data_extraction.py\n\u2502   \u251c\u2500\u2500 preprocessing.py\n\u2502   \u251c\u2500\u2500 config.py\n\u2502   \u251c\u2500\u2500 logger.py\n\u2502   \u2514\u2500\u2500 plotting.py\n\u251c\u2500\u2500 model/\n\u2502   \u251c\u2500\u2500 gcngru.py\n\u2502   \u2514\u2500\u2500 *.pkl, *.pth       \u2190 Model artifacts\n\u2514\u2500\u2500 cli/\n    \u2514\u2500\u2500 main.py            \u2190 CLI wrapper using InferenceEngine\n\nbackend/\n\u2514\u2500\u2500 app/\n    \u2514\u2500\u2500 main.py            \u2190 FastAPI wrapper using InferenceEngine\n\napp/                       \u2190 Next.js dashboard (future)\n</code></pre>"},{"location":"dev_guide/#inferenceengine-class","title":"InferenceEngine Class","text":"<p>All model loading and prediction logic is centralized in <code>src/gaca_ews/core/inference.py</code>:</p> <pre><code>from gaca_ews.core.inference import InferenceEngine\n\n# Initialize once\nengine = InferenceEngine(\"config.yaml\")\nengine.load_artifacts()  # Load model, scalers, graph\n\n# Run inference\npredictions, latest_ts = engine.run_full_pipeline()\n\n# Or step-by-step\ndata, latest_ts = engine.fetch_data()\nX = engine.preprocess(data)\npredictions = engine.predict(X)\n\n# Save results\nengine.save_predictions(predictions, latest_ts, \"output.csv\")\nengine.generate_plots(predictions, latest_ts, \"plots/\")\n</code></pre> <p>Key Benefits: - \u2705 Zero code duplication - CLI and API both use InferenceEngine - \u2705 Single point of change - Bug fixes/updates apply everywhere - \u2705 Consistent behavior - Same predictions from CLI and API - \u2705 Easy testing - Test one class, all interfaces work - \u2705 Type-safe - Full Python 3.12+ type hints</p>"},{"location":"dev_guide/#directory-structure","title":"Directory Structure","text":"<pre><code>gaca-early-warning/\n\u251c\u2500\u2500 src/gaca_ews/              # Main Python package\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 core/                  # Core inference logic\n\u2502   \u2502   \u251c\u2500\u2500 inference.py      # \u2190 InferenceEngine (shared by all)\n\u2502   \u2502   \u251c\u2500\u2500 config.py\n\u2502   \u2502   \u251c\u2500\u2500 data_extraction.py\n\u2502   \u2502   \u251c\u2500\u2500 preprocessing.py\n\u2502   \u2502   \u251c\u2500\u2500 logger.py\n\u2502   \u2502   \u2514\u2500\u2500 plotting.py\n\u2502   \u251c\u2500\u2500 model/                 # Model and artifacts\n\u2502   \u2502   \u251c\u2500\u2500 gcngru.py\n\u2502   \u2502   \u251c\u2500\u2500 final_model.pth\n\u2502   \u2502   \u251c\u2500\u2500 feature_scaler.pkl\n\u2502   \u2502   \u2514\u2500\u2500 target_scaler.pkl\n\u2502   \u2514\u2500\u2500 cli/                   # Command-line interface\n\u2502       \u2514\u2500\u2500 main.py\n\u251c\u2500\u2500 backend/                   # FastAPI backend\n\u2502   \u251c\u2500\u2500 app/\n\u2502   \u2502   \u251c\u2500\u2500 main.py           # API routes (uses InferenceEngine)\n\u2502   \u2502   \u2514\u2500\u2500 __init__.py\n\u2502   \u2514\u2500\u2500 test_api.py\n\u251c\u2500\u2500 app/                       # Next.js dashboard\n\u2502   \u251c\u2500\u2500 app/\n\u2502   \u2502   \u251c\u2500\u2500 layout.tsx\n\u2502   \u2502   \u251c\u2500\u2500 page.tsx\n\u2502   \u2502   \u2514\u2500\u2500 globals.css\n\u2502   \u251c\u2500\u2500 package.json\n\u2502   \u2514\u2500\u2500 tsconfig.json\n\u251c\u2500\u2500 data/                      # Graph and node data\n\u2502   \u251c\u2500\u2500 edge_index.pt\n\u2502   \u251c\u2500\u2500 edge_weight.pt\n\u2502   \u251c\u2500\u2500 nodes_latlon.csv\n\u2502   \u2514\u2500\u2500 G_base.pkl\n\u251c\u2500\u2500 tests/                     # Unit tests\n\u251c\u2500\u2500 docs/                      # Documentation\n\u251c\u2500\u2500 config.yaml                # Pipeline configuration\n\u2514\u2500\u2500 pyproject.toml             # Package configuration\n</code></pre>"},{"location":"dev_guide/#installation","title":"Installation","text":"<pre><code># Install with all dependencies\nuv sync --all-extras --dev\n\n# CLI is automatically installed\ngaca-ews --help\n</code></pre>"},{"location":"dev_guide/#cli-usage","title":"CLI Usage","text":""},{"location":"dev_guide/#commands","title":"Commands","text":""},{"location":"dev_guide/#1-predict-run-inference","title":"1. <code>predict</code> - Run Inference","text":"<pre><code># Basic usage\ngaca-ews predict\n\n# With options\ngaca-ews predict --config config.yaml --output results/ --verbose\n\n# Without plots (faster)\ngaca-ews predict --no-plots\n\n# Full options\ngaca-ews predict \\\n  --config config.yaml \\\n  --output predictions/ \\\n  --plots \\\n  --csv \\\n  --verbose\n</code></pre> <p>Options: - <code>-c, --config PATH</code> - Configuration file (default: <code>config.yaml</code>) - <code>-o, --output PATH</code> - Output directory (default: from config) - <code>--plots/--no-plots</code> - Generate visualizations (default: yes) - <code>--csv/--no-csv</code> - Save CSV file (default: yes) - <code>-v, --verbose</code> - Detailed output</p> <p>Example Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 \ud83c\udf21\ufe0f  GACA Early Warning System     \u2502\n\u2502 Temperature Forecasting Pipeline \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n\u280b Loading model artifacts...  \u2501\u2501\u2501\u2501\u2501\u2501  0:00:05\n\u2819 Fetching NOAA meteorological data...\n  Fetched 336,120 rows \u2022 Latest: 2025-11-18 08:00 UTC\n\u2839 Preprocessing features...\n  Input shape: torch.Size([1, 24, 14005, 8])\n\u2838 Running model inference...\n  Output shape: (1, 7, 14005, 1)\n\u283c Saving predictions to CSV...\n\u2834 Generating visualization plots...\n\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 \u2713 Prediction Complete!              \u2502\n\u2502                                     \u2502\n\u2502 \ud83d\udcca 98,035 predictions               \u2502\n\u2502 \ud83d\udccd 14,005 locations                 \u2502\n\u2502 \ud83d\udd50 7 time horizons                  \u2502\n\u2502 \ud83c\udf21\ufe0f  -7.3\u00b0C to 8.7\u00b0C                 \u2502\n\u2502 \ud83d\udcc2 predictions/                     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n</code></pre></p>"},{"location":"dev_guide/#2-info-model-information","title":"2. <code>info</code> - Model Information","text":"<pre><code>gaca-ews info\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 \ud83c\udf21\ufe0f  GACA Model Information \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n         Model Configuration\n Architecture       GCNGRU\n Device             cpu\n Number of Nodes    14,005\n Input Features     t2m, d2m, u10, v10, sp, orog\n Forecast Horizons  [1, 6, 12, 18, 24, 36, 48]\n\n       Coverage Region\n Latitude   42.0\u00b0 to 45.0\u00b0\n Longitude  -81.0\u00b0 to -78.0\u00b0\n Region     Southwestern Ontario\n</code></pre></p>"},{"location":"dev_guide/#3-version-version-information","title":"3. <code>version</code> - Version Information","text":"<pre><code>gaca-ews version\n# or\ngaca-ews --version\n</code></pre>"},{"location":"dev_guide/#api-backend","title":"API Backend","text":""},{"location":"dev_guide/#starting-the-server","title":"Starting the Server","text":"<pre><code># Development with auto-reload\nuvicorn backend.app.main:app --reload --host 0.0.0.0 --port 8000\n\n# Production\nuvicorn backend.app.main:app --host 0.0.0.0 --port 8000\n</code></pre> <p>The API will be available at: - Base URL: http://localhost:8000 - Interactive docs: http://localhost:8000/docs - ReDoc: http://localhost:8000/redoc</p>"},{"location":"dev_guide/#api-endpoints","title":"API Endpoints","text":""},{"location":"dev_guide/#get","title":"GET /","text":"<p>Root endpoint with API information</p> <p>Response: <pre><code>{\n  \"message\": \"GACA Early Warning System API\",\n  \"version\": \"0.1.0\",\n  \"status\": \"online\"\n}\n</code></pre></p>"},{"location":"dev_guide/#get-health","title":"GET /health","text":"<p>Health check endpoint</p> <p>Response: <pre><code>{\n  \"status\": \"healthy\",\n  \"model_loaded\": true\n}\n</code></pre></p>"},{"location":"dev_guide/#get-modelinfo","title":"GET /model/info","text":"<p>Model configuration and information</p> <p>Response: <pre><code>{\n  \"model_architecture\": \"GCNGRU\",\n  \"num_nodes\": 14005,\n  \"input_features\": [\"t2m\", \"d2m\", \"u10\", \"v10\", \"sp\", \"orog\"],\n  \"prediction_horizons\": [1, 6, 12, 18, 24, 36, 48],\n  \"region\": {\n    \"lat_min\": 42.0,\n    \"lat_max\": 45.0,\n    \"lon_min\": -81.0,\n    \"lon_max\": -78.0\n  },\n  \"status\": \"loaded\"\n}\n</code></pre></p>"},{"location":"dev_guide/#post-predict","title":"POST /predict","text":"<p>Run full inference pipeline</p> <p>Request: <pre><code>{\n  \"num_hours\": 24\n}\n</code></pre></p> <p>Process: 1. Fetches 24 hours of NOAA URMA data 2. Preprocesses features with spatial consistency 3. Runs GCNGRU model for 7 forecast horizons 4. Returns predictions for all 14,005 grid points</p> <p>Response: Array of 98,035 predictions (14,005 nodes \u00d7 7 horizons) <pre><code>[\n  {\n    \"forecast_time\": \"2025-11-18T09:00:00\",\n    \"horizon_hours\": 1,\n    \"lat\": 42.00008,\n    \"lon\": -80.84195,\n    \"predicted_temp\": 2.97\n  },\n  ...\n]\n</code></pre></p>"},{"location":"dev_guide/#get-predictionslatest","title":"GET /predictions/latest","text":"<p>Retrieve most recent predictions from file</p> <p>Response: <pre><code>{\n  \"count\": 98035,\n  \"predictions\": [...],\n  \"file_timestamp\": \"2025-11-18T10:00:00\"\n}\n</code></pre></p>"},{"location":"dev_guide/#testing","title":"Testing","text":""},{"location":"dev_guide/#unit-tests","title":"Unit Tests","text":"<pre><code># Run all unit tests\nuv run pytest -m \"not integration_test\" --cov . tests\n\n# Specific test file\nuv run pytest tests/test_imports.py -v\n</code></pre>"},{"location":"dev_guide/#api-testing","title":"API Testing","text":"<pre><code># Quick health check\ncurl http://localhost:8000/health\n\n# Model information\ncurl http://localhost:8000/model/info\n\n# Run inference (takes ~45 seconds)\ncurl -X POST http://localhost:8000/predict \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"num_hours\": 24}' \\\n  -o predictions.json\n\n# Analyze results\npython3 &lt;&lt; 'EOF'\nimport json\nwith open('predictions.json') as f:\n    preds = json.load(f)\nprint(f\"Total: {len(preds):,} predictions\")\ntemps = [p['predicted_temp'] for p in preds]\nprint(f\"Range: {min(temps):.1f}\u00b0C to {max(temps):.1f}\u00b0C\")\nEOF\n</code></pre>"},{"location":"dev_guide/#cli-testing","title":"CLI Testing","text":"<pre><code># Test info command\ngaca-ews info\n\n# Test predict with verbose output\ngaca-ews predict --no-plots --verbose\n</code></pre>"},{"location":"dev_guide/#configuration","title":"Configuration","text":"<p>The <code>config.yaml</code> file controls all pipeline parameters:</p> <pre><code>model:\n  feature_scaler_path: \"./src/gaca_ews/model/feature_scaler.pkl\"\n  target_scaler_path: \"./src/gaca_ews/model/target_scaler.pkl\"\n  model_path: \"./src/gaca_ews/model/final_model.pth\"\n\ngraph:\n  edge_index_path: \"./data/edge_index.pt\"\n  edge_weight_path: \"./data/edge_weight.pt\"\n  nodes_csv_path: \"./data/nodes_latlon.csv\"\n  G_base_path: \"./data/G_base.pkl\"\n\nrun_dir: \"./predictions\"\nmake_plots: \"y\"\n\n# DO NOT CHANGE - tied to trained model\nregion:\n  lat_min: 42.0\n  lat_max: 45.0\n  lon_min: -81.0\n  lon_max: -78.0\n\nnum_hours_to_fetch: 24\npred_offsets: [1, 6, 12, 18, 24, 36, 48]\nfeatures: [\"t2m\", \"d2m\", \"u10\", \"v10\", \"sp\", \"orog\"]\nmodel_arch: \"GCNGRU\"\n</code></pre>"},{"location":"dev_guide/#development","title":"Development","text":""},{"location":"dev_guide/#adding-new-features","title":"Adding New Features","text":"<p>To extend the inference engine:</p> <pre><code># In src/gaca_ews/core/inference.py\n\nclass InferenceEngine:\n    def your_new_method(self) -&gt; Any:\n        \"\"\"Add new functionality here.\"\"\"\n        # Both CLI and API can use it immediately\n        pass\n</code></pre> <p>To add a new CLI command:</p> <pre><code># In src/gaca_ews/cli/main.py\n\n@app.command(name=\"new-command\")\ndef new_command(\n    config: Annotated[Path, typer.Option(\"--config\", \"-c\")] = Path(\"config.yaml\"),\n) -&gt; None:\n    \"\"\"Your command description.\"\"\"\n    engine = InferenceEngine(config)\n    # Use engine methods\n    console.print(\"[green]Done![/green]\")\n</code></pre> <p>To add a new API endpoint:</p> <pre><code># In backend/app/main.py\n\n@app.get(\"/new-endpoint\")\nasync def new_endpoint() -&gt; dict:\n    \"\"\"Your endpoint description.\"\"\"\n    if engine is None:\n        raise HTTPException(503, \"Model not loaded\")\n\n    # Use engine methods\n    result = engine.your_new_method()\n    return {\"result\": result}\n</code></pre>"},{"location":"dev_guide/#code-quality","title":"Code Quality","text":"<p>The project follows strict quality standards:</p> <ul> <li>Type hints: All functions have full type annotations (Python 3.12+ syntax)</li> <li>Docstrings: NumPy-style docstrings for all public functions</li> <li>Linting: <code>ruff</code> for code formatting and linting</li> <li>Type checking: <code>mypy</code> in strict mode</li> <li>Testing: <code>pytest</code> with coverage tracking</li> </ul> <pre><code># Run all quality checks\npre-commit run --all-files\n\n# Individual tools\nruff check .              # Linting\nruff format .             # Formatting\nmypy .                    # Type checking\npytest --cov . tests      # Testing with coverage\n</code></pre>"},{"location":"dev_guide/#dependencies","title":"Dependencies","text":""},{"location":"dev_guide/#core-package","title":"Core Package","text":"<ul> <li>Python &gt;=3.12</li> <li>ML: torch, torch-geometric, scikit-learn==1.7.1</li> <li>Data: pandas, numpy, joblib</li> <li>API: fastapi, uvicorn, pydantic</li> <li>CLI: typer, rich</li> <li>NOAA: boto3, pygrib</li> <li>Visualization: matplotlib, networkx</li> </ul>"},{"location":"dev_guide/#dashboard","title":"Dashboard","text":"<ul> <li>Next.js 16</li> <li>React 19</li> <li>TypeScript 5</li> <li>Tailwind CSS 4</li> </ul>"},{"location":"dev_guide/#performance-metrics","title":"Performance Metrics","text":""},{"location":"dev_guide/#tested-on-november-18-2025","title":"Tested on November 18, 2025","text":"<p>Inference Pipeline: - NOAA data fetch: ~15-45 seconds (network dependent) - Preprocessing: ~2 seconds - Model inference: ~5 seconds (CPU) - Total: ~25-55 seconds</p> <p>Output: - 98,035 predictions (14,005 locations \u00d7 7 horizons) - Temperature range: -7.3\u00b0C to 8.7\u00b0C - CSV file: ~3.5 MB - Plots: 7 spatial maps + timeseries</p> <p>Data Quality: - \u2705 All required fields present - \u2705 Geographic bounds validated - \u2705 Temperature values reasonable - \u2705 Spatial consistency maintained - \u2705 No NaN values</p>"},{"location":"dev_guide/#troubleshooting","title":"Troubleshooting","text":""},{"location":"dev_guide/#model-not-loading","title":"Model Not Loading","text":"<pre><code># Check config paths\ngaca-ews info\n\n# Verify files exist\nls -la src/gaca_ews/model/\nls -la data/\n</code></pre>"},{"location":"dev_guide/#noaa-data-fetch-failing","title":"NOAA Data Fetch Failing","text":"<pre><code># Run with verbose output\ngaca-ews predict --verbose\n\n# Check network\ncurl -I https://noaa-urma-pds.s3.amazonaws.com\n</code></pre>"},{"location":"dev_guide/#api-server-issues","title":"API Server Issues","text":"<pre><code># Check if server is running\ncurl http://localhost:8000/health\n\n# View server logs\nuvicorn backend.app.main:app --log-level debug\n\n# Kill existing servers\nlsof -ti:8000 | xargs kill -9\n</code></pre>"},{"location":"dev_guide/#best-practices","title":"Best Practices","text":"<ol> <li>Always use InferenceEngine - Never duplicate inference logic</li> <li>Type everything - Use Python 3.12+ type hints (<code>|</code> instead of <code>Union</code>)</li> <li>Test before committing - Run <code>pre-commit run --all-files</code></li> <li>Update docs - Keep this guide in sync with code changes</li> <li>Version pin carefully - scikit-learn is pinned to match artifacts</li> </ol>"},{"location":"dev_guide/#next-steps","title":"Next Steps","text":"<ol> <li>Dashboard Development - Connect Next.js to FastAPI backend</li> <li>Caching - Add Redis for prediction caching</li> <li>Monitoring - Add Prometheus metrics</li> <li>Authentication - Implement API keys/OAuth</li> <li>Docker - Containerize for deployment</li> <li>CI/CD - Automate testing and deployment</li> <li>Horizontal Scaling - Add load balancing</li> </ol>"},{"location":"dev_guide/#notes","title":"Notes","text":"<ul> <li>scikit-learn pinned to 1.7.1 to match trained scaler artifacts</li> <li>NOAA data may lag real-time by 1-2 hours</li> <li>Model artifacts total ~32 MB</li> <li>Graph data is pre-computed and fixed</li> <li>Region boundaries are tied to the trained model and cannot be changed</li> <li>Positional encodings (lat/lon \u00d7 0.01) must remain consistent with training</li> </ul>"}]}